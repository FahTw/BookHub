{% extends "../base_user.html" %}
{% load static %}

{% block title %}
ชำระเงิน
{% endblock %}

{% block script1 %}
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'orange': {
                            50: '#fff7ed',
                            100: '#ffedd5',
                            200: '#fed7aa',
                            300: '#fdba74',
                            400: '#fb923c',
                            500: '#f97316',
                            600: '#ea580c',
                            700: '#c2410c',
                            800: '#9a3412',
                            900: '#7c2d12'
                        }
                    }
                }
            }
        }
    </script>
{% endblock %}

{% block sytle %}
    <style>
        .payment-method-card.active {
            border-color: #ea580c !important;
            background-color: #fff7ed;
        }
        
        .payment-section {
            transition: all 0.3s ease;
        }
        
        .payment-section.hidden {
            display: none;
        }
        
        #file-drop-zone.dragover {
            border-color: #fb923c;
            background-color: #fff7ed;
        }
        
        .animate-pulse {
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
{% endblock %}

{% block content %}
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 lg:py-12">
        <!-- Page Header -->
        <div class="mb-8">
            <h1 class="text-2xl lg:text-3xl font-bold text-gray-900 mb-2">ชำระเงิน</h1>
            <p class="text-gray-600">กรุณาชำระเงินเพื่อสั่งซื้อหนังสือ</p>
        </div>

        <div class="lg:grid lg:grid-cols-12 lg:gap-8">
            <!-- Payment Section -->
            <div class="lg:col-span-8">
                <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                    <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
                        <h2 class="text-lg font-semibold text-gray-900">วิธีการชำระเงิน</h2>
                    </div>

                    <form id="paymentForm" method="post" enctype="multipart/form-data" class="p-6">
                        {% csrf_token %}
                        <!-- Hidden fields for form data -->
                        <input type="hidden" name="order" value="{{ order.id }}">
                        <input type="hidden" name="amount" value="{{ order.total_amount }}">
                        <input type="hidden" name="payment_date" value="">
                        <input type="hidden" name="status" value="pending">
                        <script>
                            document.querySelector('input[name="payment_date"]').value = new Date().toISOString();
                        </script>
                        <!-- Payment Method Selection -->
                        <div class="mb-8">
                            <h3 class="text-lg font-semibold text-gray-900 mb-6">เลือกวิธีการชำระเงิน</h3>
                            <div class="grid md:grid-cols-3 gap-4">
                                <label class="payment-method-option cursor-pointer">
                                    <input type="radio" name="method" value="promptpay" class="sr-only payment-method-radio" checked>
                                    <div class="border-2 border-gray-200 rounded-lg p-4 hover:border-orange-300 transition-colors payment-method-card active">
                                        <div class="flex items-center gap-3">
                                            <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                                                <svg class="w-6 h-6 text-orange-600" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M3 3h6v6H3V3zm2 2v2h2V5H5zM3 15h6v6H3v-6zm2 2v2h2v-2H5zM15 3h6v6h-6V3zm2 2v2h2V5h-2z"/>
                                                </svg>
                                            </div>
                                            <div>
                                                <h4 class="font-medium text-gray-900">พร้อมเพย์</h4>
                                                <p class="text-sm text-gray-500">สแกน QR Code</p>
                                            </div>
                                        </div>
                                    </div>
                                </label>

                                <label class="payment-method-option cursor-pointer">
                                    <input type="radio" name="method" value="bank" class="sr-only payment-method-radio">
                                    <div class="border-2 border-gray-200 rounded-lg p-4 hover:border-orange-300 transition-colors payment-method-card">
                                        <div class="flex items-center gap-3">
                                            <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                                                <svg class="w-6 h-6 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                                                    <path d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 2h12v2H4V6zm0 4h12v4H4v-4z"/>
                                                </svg>
                                            </div>
                                            <div>
                                                <h4 class="font-medium text-gray-900">โอนเงินผ่านธนาคาร</h4>
                                                <p class="text-sm text-gray-500">โอนเข้าบัญชีธนาคาร</p>
                                            </div>
                                        </div>
                                    </div>
                                </label>

                                <label class="payment-method-option cursor-pointer">
                                    <input type="radio" name="method" value="cash" class="sr-only payment-method-radio">
                                    <div class="border-2 border-gray-200 rounded-lg p-4 hover:border-orange-300 transition-colors payment-method-card">
                                        <div class="flex items-center gap-3">
                                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                                <svg class="w-6 h-6 text-green-600" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V16h-2.67v2.09c-2.84-.48-5.09-2.8-5.09-5.59s2.25-5.11 5.09-5.59V9h2.67v-1.91c2.84.48 5.09 2.8 5.09 5.59s-2.25 5.11-5.09 5.59z"/>
                                                </svg>
                                            </div>
                                            <div>
                                                <h4 class="font-medium text-gray-900">เก็บเงินปลายทาง</h4>
                                                <p class="text-sm text-gray-500">ชำระเงินเมื่อได้รับสินค้า</p>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- QR Code Section -->
                        <div id="qr-section" class="payment-section active mb-8">
                            <h3 class="text-xl font-bold text-center mb-4 text-gray-900">สแกน QR Code เพื่อชำระเงิน</h3>
                            <p class="text-gray-600 text-center mb-8">
                                ใช้กล้องมือถือหรือแอปสแกน QR Code<br>
                                เพื่อทำการชำระเงิน
                            </p>

                            <div class="flex justify-center mb-6">
                                <div class="bg-orange-100 p-8 rounded-2xl">
                                    <div class="bg-white p-6 rounded-xl shadow-lg">
                                        <div class="w-40 h-40 bg-gray-200 rounded-lg flex items-center justify-center">
                                            <svg class="w-20 h-20 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M3 3h6v6H3V3zm2 2v2h2V5H5zM3 15h6v6H3v-6zm2 2v2h2v-2H5zM15 3h6v6h-6V3zm2 2v2h2V5h-2zM19 13h2v2h-2v-2zM13 15h2v2h-2v-2zM15 17h2v2h-2v-2zM17 15h2v2h-2v-2zM19 17h2v2h-2v-2zM21 19h2v2h-2v-2zM15 19h2v2h-2v-2zM13 13h2v2h-2v-2zM15 11h2v2h-2v-2zM13 17h2v2h-2v-2zM11 3h2v2h-2V3zM11 7h2v2h-2V7zM13 5h2v2h-2V5zM13 7h2v2h-2V7zM13 9h2v2h-2V9zM11 11h2v2h-2v-2zM11 13h2v2h-2v-2zM11 15h2v2h-2v-2zM11 17h2v2h-2v-2zM11 19h2v2h-2v-2zM11 21h2v2h-2v-2z" />
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="text-center">
                                <p class="text-gray-500 text-sm">จำนวนเงินที่ต้องชำระ: 
                                    <span class="font-semibold text-orange-600">฿127</span>
                                </p>
                            </div>
                        </div>

                        <!-- Bank Transfer Section -->
                        <div id="bank-transfer-section" class="payment-section hidden mb-8">
                            <h3 class="text-xl font-bold text-center mb-4 text-gray-900">ข้อมูลบัญชีสำหรับโอนเงิน</h3>
                            <div class="bg-gray-50 rounded-lg p-6 mb-6">
                                <div class="grid md:grid-cols-2 gap-6">
                                    <div>
                                        <h4 class="font-semibold text-gray-900 mb-2">ธนาคารกสิกรไทย</h4>
                                        <p class="text-gray-600">เลขบัญชี: <span class="font-mono">012-3-45678-9</span></p>
                                        <p class="text-gray-600">ชื่อบัญชี: บุ๊คฮับ จำกัด</p>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-gray-900 mb-2">ธนาคารไทยพาณิชย์</h4>
                                        <p class="text-gray-600">เลขบัญชี: <span class="font-mono">123-4-56789-0</span></p>
                                        <p class="text-gray-600">ชื่อบัญชี: บุ๊คฮับ จำกัด</p>
                                    </div>
                                </div>
                                <div class="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                                    <p class="text-sm text-yellow-800">
                                        <strong>หมายเหตุ:</strong> กรุณาโอนเงินตามจำนวนที่ระบุ และอัพโหลดสลิปการโอนด้านล่าง
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- File Upload Section -->
                        <div class="mb-8" id="file-upload-section">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">อัพโหลดหลักฐานการชำระเงิน</h3>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-orange-400 transition-colors">
                                <input type="file" id="payment_slip" name="payment_slip" accept="image/*,.pdf" class="hidden">
                                <svg class="w-12 h-12 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 48 48">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" />
                                </svg>
                                <h4 class="text-lg font-medium text-gray-900 mb-2">อัพโหลดสลิปการโอนเงิน</h4>
                                <p class="text-gray-500 mb-4">เลือกไฟล์รูปภาพสลิป</p>
                                <button type="button" onclick="document.getElementById('payment_slip').click()" class="inline-flex items-center px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                                    </svg>
                                    เลือกไฟล์
                                </button>
                                <p class="text-xs text-gray-400 mt-2">รองรับ JPG, PNG, PDF (ขนาดไม่เกิน 5MB)</p>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="text-center">
                            <button type="submit" class="w-full md:w-auto px-8 py-3 bg-orange-600 text-white font-semibold rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" id="submit-payment" disabled>
                                <span class="inline-flex items-center">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                    </svg>
                                    ยืนยันการชำระเงิน
                                </span>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Back to Cart -->
                <div class="mt-6">
                    <a href="/cart/11" class="inline-flex items-center text-orange-600 hover:text-orange-700 font-medium">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        กลับไปที่ตะกร้าสินค้า
                    </a>
                </div>
            </div>

            <!-- Order Summary Section -->
            <div class="lg:col-span-4 mt-8 lg:mt-0">
                <div class="bg-white rounded-lg shadow-sm overflow-hidden sticky top-24">
                    <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
                        <h2 class="text-lg font-semibold text-gray-900">สรุปรายการสั่งซื้อ</h2>
                    </div>

                    <div class="p-6">
                        <!-- Order Items -->
                        { for item in  %}
                        <div class="space-y-4 mb-6">
                            <div class="flex items-center gap-4 pb-4 border-b border-gray-100">
                                <div class="w-16 h-20 bg-gray-200 rounded flex-shrink-0 overflow-hidden">
                                    <img src="/api/placeholder/64/80" alt="จิตวิทยาสายดาร์ก"
                                        class="w-full h-full object-cover" />
                                </div>
                                <div class="flex-1 min-w-0">
                                    <h3 class="font-semibold text-gray-900 mb-1 truncate">จิตวิทยาสายดาร์ก</h3>
                                    <p class="text-sm text-gray-500 mb-1">โดย Taneaw</p>
                                    <p class="text-sm text-gray-500">จำนวน: 1 เล่ม</p>
                                </div>
                                <div class="text-right">
                                    <span class="font-semibold text-gray-900">฿77</span>
                                </div>
                            </div>
                        </div>
                        { endfor %}

                        <!-- Order Totals -->
                        <div class="space-y-3 mb-6">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">ยอดรวมสินค้า</span>
                                <span class="text-gray-900">฿127</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">ค่าจัดส่ง</span>
                                <span class="text-green-600">ฟรี</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">ส่วนลด</span>
                                <span class="text-red-500">-฿50</span>
                            </div>
                            <div class="border-t border-gray-200 pt-3">
                                <div class="flex justify-between">
                                    <span class="font-semibold text-gray-900">ยอดรวมทั้งหมด</span>
                                    <span class="font-semibold text-lg text-orange-600">฿77</span>
                                </div>
                            </div>
                        </div>

                        <!-- Security Notice -->
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
                            <div class="flex items-center">
                                <svg class="w-5 h-5 text-green-600 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 1L5 6v4c0 5.55 3.84 9.74 9 9.74s9-4.19 9-9.74V6l-5-5H10zm0 2.5L12.5 6v3.5c0 3.33-2.17 5.83-5 5.83s-5-2.5-5-5.83V6L5 3.5h5z" />
                                </svg>
                                <div>
                                    <p class="text-sm font-medium text-green-800">การชำระเงินปลอดภัย</p>
                                    <p class="text-xs text-green-600">ข้อมูลของคุณได้รับการคุ้มครอง</p>
                                </div>
                            </div>
                        </div>

                        <!-- Cancel Order -->
                        <a href="{% url 'home' %}">
                        <button data-cancel-order class="w-full border border-gray-300 text-gray-700 hover:bg-gray-50 font-medium py-3 px-6 rounded-lg transition-colors mb-3">
                            ยกเลิกการสั่งซื้อ
                        </button>
                        </a>

                        <p class="text-xs text-gray-500 text-center">
                            หากมีปัญหาในการชำระเงิน กรุณาติดต่อ BookHub
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </main>
{% endblock %}

{% block script2 %}
    <script src="../../static/script/payment.js"></script>
{% endblock %}